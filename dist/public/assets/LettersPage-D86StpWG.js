import{j as e,C as N,B as j,H as L}from"./index-D1umKIgS.js";import{r as m}from"./router-CgUf3kh0.js";import{C as g,c as p,a as v,b as y}from"./card-B-z3UqDt.js";import{T as S}from"./textarea-QJMeZBkp.js";import{L as E}from"./label-Hh7YhjFH.js";import{T as C}from"./trash-2-By5fSsWJ.js";import{S as T}from"./send-LMGbKd1V.js";import"./vendor-CM9vOon3.js";function k(){const[l,h]=m.useState([]),[i,c]=m.useState(!0),[a,d]=m.useState(null),x=async()=>{try{console.log("Fetching letters...");let r=0;const t=3;let s;for(;r<t;)try{s=await fetch("/api/letters",{method:"GET",headers:{"Content-Type":"application/json"}});break}catch(n){if(r++,console.warn(`Network attempt ${r} failed:`,n),r>=t)throw new Error("Network connection failed. Please check your internet connection and try again.");await new Promise(f=>setTimeout(f,1e3*r))}if(!s)throw new Error("Failed to connect to server");if(!s.ok){const n=await s.text();throw new Error(`Server error: ${s.status} - ${n}`)}const o=await s.json();console.log("Fetched letters:",o),h(o),d(null)}catch(r){console.error("Error fetching letters:",r);const t=r instanceof Error?r.message:"Failed to fetch letters";d(t)}},w=async r=>{try{console.log("Creating letter:",r);const t=await fetch("/api/letters",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!t.ok){const s=await t.text();throw new Error(`Failed to save letter: ${t.status} - ${s}`)}await x(),console.log("Letter saved successfully")}catch(t){console.error("Error creating letter:",t);const s=t instanceof Error?t.message:"Failed to save letter";throw d(s),t}},b=async r=>{try{console.log("Deleting letter:",r);const t=await fetch(`/api/letters/${r}`,{method:"DELETE"});if(!t.ok){const s=await t.text();throw new Error(`Failed to delete letter: ${t.status} - ${s}`)}await x(),console.log("Letter deleted successfully")}catch(t){console.error("Error deleting letter:",t);const s=t instanceof Error?t.message:"Failed to delete letter";throw d(s),t}};return m.useEffect(()=>{(async()=>{c(!0),await x(),c(!1)})()},[]),{letters:l,loading:i,error:a,createLetter:w,deleteLetter:b,refetch:x}}function D({letters:l,onDelete:h}){const i=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),c=a=>{confirm("Are you sure you want to delete this letter?")&&h(a)};return l.length===0?e.jsx(g,{className:"bg-white border-blue-200",children:e.jsx(p,{className:"p-6 text-center",children:e.jsx("p",{className:"bg-gradient-to-r from-blue-600 via-amber-500 to-blue-600 bg-clip-text text-transparent font-semibold",children:"No letters have been sent yet."})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold bg-gradient-to-r from-yellow-400 via-amber-500 to-yellow-400 bg-clip-text text-transparent",children:"Previously Sent Letters"}),l.map(a=>e.jsxs(g,{className:"bg-white border-blue-200 shadow-md",children:[e.jsx(v,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs(y,{className:"text-sm flex items-center gap-2 bg-gradient-to-r from-blue-600 via-amber-500 to-blue-600 bg-clip-text text-transparent font-bold",children:[e.jsx(N,{className:"h-4 w-4 text-blue-500"}),i(a.created_at)]}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>c(a.id),className:"border-blue-300 text-blue-600 hover:bg-blue-50",children:e.jsx(C,{className:"h-4 w-4"})})]})}),e.jsx(p,{className:"pt-0",children:e.jsx("div",{className:"text-sm whitespace-pre-wrap bg-blue-50 p-3 rounded border border-blue-200 bg-gradient-to-r from-blue-700 via-amber-600 to-blue-700 bg-clip-text text-transparent font-semibold",children:a.content})})]},a.id))]})}function A(){const[l,h]=m.useState(""),[i,c]=m.useState(!1),[a,d]=m.useState(!1),{letters:x,loading:w,error:b,createLetter:r,deleteLetter:t}=k(),s=async()=>{if(l.trim()){c(!0),d(!0);try{await new Promise(o=>setTimeout(o,4e3)),await r({content:l}),h("")}catch(o){console.error("Error sending letter:",o)}finally{c(!1),d(!1)}}};return w?e.jsx("div",{className:"space-y-6",children:e.jsx(g,{children:e.jsx(p,{className:"p-6 text-center",children:"Loading letters..."})})}):b?e.jsx("div",{className:"space-y-6",children:e.jsx(g,{children:e.jsxs(p,{className:"p-6 text-center text-red-600",children:["Error: ",b]})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-3xl font-bold tracking-tight flex items-center justify-center gap-2",children:[e.jsx(L,{className:"h-8 w-8 text-amber-500"}),e.jsx("span",{className:"bg-gradient-to-r from-blue-600 via-amber-500 to-blue-600 bg-clip-text text-transparent",children:"Liulei Nishmas Chaya Sara Leah Bas Uri"})]}),e.jsx("p",{className:"mt-2 bg-gradient-to-r from-blue-700 via-amber-600 to-blue-700 bg-clip-text text-transparent font-semibold",children:"Write a heartfelt message to send to heaven"})]}),e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(y,{className:"bg-gradient-to-r from-blue-600 via-amber-500 to-blue-600 bg-clip-text text-transparent font-bold",children:"Write Your Letter"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"letter",className:"bg-gradient-to-r from-blue-700 via-amber-600 to-blue-700 bg-clip-text text-transparent font-semibold text-lg",children:"Dear Chaya Sara Leah,"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{id:"letter",placeholder:"Share your thoughts, memories, or just say hello...",value:l,onChange:o=>h(o.target.value),rows:8,className:"resize-none relative z-10 bg-transparent border border-gray-300 rounded-md p-3",style:{color:"transparent",caretColor:"#2563eb"}}),e.jsx("div",{className:"absolute inset-0 p-3 pointer-events-none overflow-hidden whitespace-pre-wrap break-words rounded-md font-mono",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},children:l.split("").map((o,n)=>{const f=n%7;let u;return f<3?u="#facc15":f===3?u="#fbbf24":f===4?u="#3b82f6":f===5?u="#2563eb":u="#1e40af",e.jsx("span",{style:{color:u},children:o},n)})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(j,{onClick:s,disabled:!l.trim()||i,className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),i?"Sending to heaven...":"Send Letter"]})}),i&&e.jsx("div",{className:"text-center text-muted-foreground",children:e.jsx("p",{children:"Your message is being delivered with love..."})})]})]}),e.jsx(D,{letters:x,onDelete:t})]}),a&&e.jsxs("div",{className:"fixed inset-0 pointer-events-none z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute top-1/3 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10",children:e.jsx("div",{className:"animate-pulse",children:e.jsx("h2",{className:"text-4xl font-bold bg-gradient-to-r from-yellow-400 via-amber-500 to-yellow-400 bg-clip-text text-transparent text-center drop-shadow-lg",children:"✨ Sending to Heaven... ✨"})})}),e.jsx("div",{className:"absolute inset-0",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{className:"absolute transform transition-all duration-4000 ease-in-out",style:{animation:"dove-flight 4s ease-in-out forwards",left:"-100px",top:"60%"},children:e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:"/dove_no_background.png",alt:"Dove",className:"w-20 h-16 filter drop-shadow-lg transform",style:{animation:"wing-flap 0.5s ease-in-out infinite"}}),e.jsx("div",{className:"absolute -bottom-1 right-2 w-6 h-4 bg-white border border-gray-300 transform rotate-12 shadow-sm flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-blue-600",children:"✉"})})]})}),e.jsx("div",{className:"absolute inset-0",children:[...Array(12)].map((o,n)=>e.jsx("div",{className:"absolute animate-ping",style:{left:`${20+n*7}%`,top:`${40+n%3*10}%`,animationDelay:`${n*.3}s`,animationDuration:"2s"},children:e.jsx("span",{className:"text-yellow-400 text-lg",children:"✨"})},n))})]})})]}),e.jsx("style",{dangerouslySetInnerHTML:{__html:`
          @keyframes dove-flight {
            0% {
              left: -100px;
              top: 60%;
              transform: rotate(0deg) scale(1);
            }
            25% {
              left: 25%;
              top: 55%;
              transform: rotate(-5deg) scale(1.1);
            }
            50% {
              left: 50%;
              top: 45%;
              transform: rotate(-10deg) scale(1.2);
            }
            75% {
              left: 75%;
              top: 30%;
              transform: rotate(-15deg) scale(1.1);
            }
            100% {
              left: 110%;
              top: 10%;
              transform: rotate(-20deg) scale(0.8);
            }
          }
          
          @keyframes wing-flap {
            0% { transform: scaleY(1); }
            50% { transform: scaleY(0.8) scaleX(1.1); }
            100% { transform: scaleY(1); }
          }
        `}})]})}export{A as LettersPage};
