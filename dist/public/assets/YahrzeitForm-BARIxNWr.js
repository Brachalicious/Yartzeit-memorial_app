import{r as h}from"./router-CgUf3kh0.js";import{j as e,B as C}from"./index-CSMyf172.js";import{I as p}from"./index-CXHT-48r.js";import{L as y}from"./label-ByEA-dlB.js";import{C as T,a as P,b as k,c as O}from"./card-DHjwif2c.js";import{S as E,a as N,b as _,c as S,d as o}from"./select-BZwTjxA0.js";function L(){const[f,t]=h.useState([]),[x,l]=h.useState([]),[u,b]=h.useState(!0),[g,i]=h.useState(null),n=async(s,r)=>{let c=0;const v=3;for(;c<v;)try{const m=await fetch(s,{...r,headers:{"Content-Type":"application/json",...r==null?void 0:r.headers}});if(!m.ok){const j=await m.text();throw new Error(`Server error: ${m.status} - ${j}`)}return m}catch(m){if(c++,console.warn(`Network attempt ${c} failed for ${s}:`,m),c>=v)throw new Error("Network connection failed. Please check your internet connection and try again.");await new Promise(j=>setTimeout(j,1e3*c))}throw new Error("Maximum retry attempts reached")},a=async()=>{try{console.log("Fetching yahrzeit entries...");const r=await(await n("/api/yahrzeit")).json();console.log("Fetched entries:",r),t(r)}catch(s){console.error("Error fetching entries:",s),i(s instanceof Error?s.message:"Failed to fetch entries")}},d=async()=>{try{console.log("Fetching upcoming yahrzeits...");const r=await(await n("/api/yahrzeit/upcoming")).json();console.log("Fetched upcoming yahrzeits:",r),l(r)}catch(s){console.error("Error fetching upcoming yahrzeits:",s),i(s instanceof Error?s.message:"Failed to fetch upcoming yahrzeits")}},w=async s=>{try{console.log("Creating yahrzeit entry:",s);const r=await n("/api/yahrzeit",{method:"POST",body:JSON.stringify(s)});await a(),await d(),console.log("Entry created successfully")}catch(r){throw console.error("Error creating entry:",r),i(r instanceof Error?r.message:"Failed to create entry"),r}},F=async(s,r)=>{try{console.log("Updating yahrzeit entry:",s,r);const c=await n(`/api/yahrzeit/${s}`,{method:"PUT",body:JSON.stringify(r)});await a(),await d(),console.log("Entry updated successfully")}catch(c){throw console.error("Error updating entry:",c),i(c instanceof Error?c.message:"Failed to update entry"),c}},z=async s=>{try{console.log("Deleting yahrzeit entry:",s);const r=await n(`/api/yahrzeit/${s}`,{method:"DELETE"});await a(),await d(),console.log("Entry deleted successfully")}catch(r){throw console.error("Error deleting entry:",r),i(r instanceof Error?r.message:"Failed to delete entry"),r}};return h.useEffect(()=>{(async()=>{b(!0),i(null),await Promise.all([a(),d()]),b(!1)})()},[]),{entries:f,upcomingYahrzeits:x,loading:u,error:g,createEntry:w,updateEntry:F,deleteEntry:z,refetch:()=>Promise.all([a(),d()])}}function B({onSubmit:f,initialData:t,title:x="Add Yahrzeit Entry"}){const[l,u]=h.useState({name:(t==null?void 0:t.name)||"",hebrew_name:(t==null?void 0:t.hebrew_name)||"",death_date:(t==null?void 0:t.death_date)||"",relationship:(t==null?void 0:t.relationship)||"",notes:(t==null?void 0:t.notes)||"",notify_days_before:(t==null?void 0:t.notify_days_before)||7}),[b,g]=h.useState(!1),i=async a=>{if(a.preventDefault(),!(!l.name||!l.death_date)){g(!0);try{await f(l),t||u({name:"",hebrew_name:"",death_date:"",relationship:"",notes:"",notify_days_before:7})}catch(d){console.error("Error submitting form:",d)}finally{g(!1)}}},n=(a,d)=>{u(w=>({...w,[a]:d}))};return e.jsxs(T,{className:"bg-gradient-to-r from-yellow-50 via-amber-50 to-yellow-50 border-amber-200",children:[e.jsx(P,{children:e.jsx(k,{className:"bg-gradient-to-r from-yellow-600 via-amber-500 to-yellow-600 bg-clip-text text-transparent",children:x})}),e.jsx(O,{children:e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"name",className:"bg-gradient-to-r from-yellow-700 via-amber-600 to-yellow-700 bg-clip-text text-transparent font-semibold",children:"Name *"}),e.jsx(p,{id:"name",type:"text",value:l.name,onChange:a=>n("name",a.target.value),placeholder:"Enter name",required:!0,className:"text-blue-700 placeholder:text-blue-400 border-amber-300 focus:border-amber-500 focus:ring-amber-200"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"hebrew_name",className:"bg-gradient-to-r from-yellow-700 via-amber-600 to-yellow-700 bg-clip-text text-transparent font-semibold",children:"Hebrew Name"}),e.jsx(p,{id:"hebrew_name",type:"text",value:l.hebrew_name,onChange:a=>n("hebrew_name",a.target.value),placeholder:"Enter Hebrew name",className:"text-blue-700 placeholder:text-blue-400 border-amber-300 focus:border-amber-500 focus:ring-amber-200"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"death_date",className:"bg-gradient-to-r from-yellow-700 via-amber-600 to-yellow-700 bg-clip-text text-transparent font-semibold",children:"Date of Passing *"}),e.jsx(p,{id:"death_date",type:"date",value:l.death_date,onChange:a=>n("death_date",a.target.value),required:!0,className:"text-blue-700 border-amber-300 focus:border-amber-500 focus:ring-amber-200"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"relationship",className:"bg-gradient-to-r from-yellow-700 via-amber-600 to-yellow-700 bg-clip-text text-transparent font-semibold",children:"Relationship"}),e.jsxs(E,{value:l.relationship,onValueChange:a=>n("relationship",a),children:[e.jsx(N,{className:"text-blue-700 border-amber-300 focus:border-amber-500 focus:ring-amber-200",children:e.jsx(_,{placeholder:"Select relationship",className:"text-blue-400"})}),e.jsxs(S,{children:[e.jsx(o,{value:"Parent",children:"Parent"}),e.jsx(o,{value:"Spouse",children:"Spouse"}),e.jsx(o,{value:"Child",children:"Child"}),e.jsx(o,{value:"Sibling",children:"Sibling"}),e.jsx(o,{value:"Grandparent",children:"Grandparent"}),e.jsx(o,{value:"Other Family",children:"Other Family"}),e.jsx(o,{value:"Friend",children:"Friend"}),e.jsx(o,{value:"Rabbi/Teacher",children:"Rabbi/Teacher"}),e.jsx(o,{value:"Other",children:"Other"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"notify_days_before",className:"bg-gradient-to-r from-yellow-700 via-amber-600 to-yellow-700 bg-clip-text text-transparent font-semibold",children:"Notification Days Before"}),e.jsxs(E,{value:l.notify_days_before.toString(),onValueChange:a=>n("notify_days_before",parseInt(a)),children:[e.jsx(N,{className:"text-blue-700 border-amber-300 focus:border-amber-500 focus:ring-amber-200",children:e.jsx(_,{})}),e.jsxs(S,{children:[e.jsx(o,{value:"1",children:"1 day"}),e.jsx(o,{value:"3",children:"3 days"}),e.jsx(o,{value:"7",children:"7 days"}),e.jsx(o,{value:"14",children:"14 days"}),e.jsx(o,{value:"30",children:"30 days"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"notes",className:"bg-gradient-to-r from-yellow-700 via-amber-600 to-yellow-700 bg-clip-text text-transparent font-semibold",children:"Notes"}),e.jsx(p,{id:"notes",type:"text",value:l.notes,onChange:a=>n("notes",a.target.value),placeholder:"Additional notes or memories",className:"text-blue-700 placeholder:text-blue-400 border-amber-300 focus:border-amber-500 focus:ring-amber-200"})]}),e.jsx(C,{type:"submit",disabled:b,className:"w-full bg-sky-400 hover:bg-sky-500 text-white font-semibold border-0 shadow-md",children:b?"Saving...":t?"Update Entry":"Add Entry"})]})})]})}export{B as Y,L as u};
